const { fetchPagesFromArray } = require('../src/fetch');
const { processTopic, scrapeProfile } = require('../src/process');
const {addProfilesToDb} = require('../src/database')
const axios = require('axios');


const BASE_URL = 'https://qbn.com/topics/';

/**
 * Fetches multiple types of profiles
 */
async function testProfiles() {
    // utopian 541583 green
    // garbage 695391 certified
    // palimpsest 764338 invited
    // ORAZAL 509741 deleted
    // bollylands 772882 uncertified

    const ids = [541583]//, 695391, 764338, 509741, 772882 ];
    const urls = ids.map(v => (BASE_URL + v + "/"));
    console.log(`urls  ${urls}`)

    const fetched = await fetchPagesFromArray(urls);
    // Process the fetched topics
    const processedDataPromises = fetched.map(data => processTopic(data));
    const processedData = await Promise.all(processedDataPromises);
    console.log(processedData);
}

/**
 * Scrape profiles from an array
 */
async function scrapeProfiles() {
    const profilesList = missingProfiles
    const profilePromises = profilesList.map(({user}) => {
        const url = `https://qbn.com/${user}`;
        return scrapeProfile(url);
    });

    const profiles = await Promise.all(profilePromises);

    // Create a mapping between ids and scraped profiles
    const profilesWithIds = profilesList.map(({ id }, index) => ({
        topicId:id,
        profile: profiles[index],
    }));

    addProfilesToDb(profilesWithIds)

}

const done = [ { "id": "71873", "user": "ithis" },
{ "id": "71875", "user": "ithis" },
{ "id": "72104", "user": "monstress" },
{ "id": "521121", "user": "UNseeN" },
        { "id": "215132", "user": "basit" },
        { "id": "224207", "user": "3rror404" },
        { "id": "251873", "user": "ithis" },
        { "id": "251875", "user": "ithis" },
        { "id": "480447", "user": "a" },
        { "id": "480449", "user": "a" },
        { "id": "480458", "user": "a" },
        { "id": "480481", "user": "a" },
        { "id": "480635", "user": "a" },
        { "id": "480764", "user": "a" },
        { "id": "480809", "user": "a" },
        { "id": "480810", "user": "a" },
        { "id": "480819", "user": "a" },
        { "id": "480979", "user": "a" },
        { "id": "481016", "user": "a" },
        { "id": "481062", "user": "a" },
        { "id": "481109", "user": "a" },
        { "id": "481216", "user": "a" },
        { "id": "481729", "user": "a" },
        { "id": "481778", "user": "a" },
        { "id": "482111", "user": "a" },
        { "id": "482159", "user": "a" },
        { "id": "482572", "user": "a" },
        { "id": "482932", "user": "a" },
        { "id": "482937", "user": "a" },
        { "id": "482950", "user": "a" },
        { "id": "483057", "user": "a" },
        { "id": "483142", "user": "a" },
        { "id": "483341", "user": "a" },
        { "id": "483422", "user": "a" },
        { "id": "483449", "user": "a" },
        { "id": "483457", "user": "a" },
        { "id": "483529", "user": "a" },
        { "id": "483680", "user": "a" },
        { "id": "483739", "user": "a" },
        { "id": "483771", "user": "a" },
        { "id": "483805", "user": "a" },
        { "id": "483806", "user": "a" },
        { "id": "483871", "user": "a" },
        { "id": "483872", "user": "a" },
        { "id": "483992", "user": "a" },
        { "id": "484021", "user": "a" },
        { "id": "484109", "user": "a" },
        { "id": "484487", "user": "a" },
        { "id": "484540", "user": "a" },
        { "id": "484643", "user": "a" },
        { "id": "484836", "user": "a" },
        { "id": "484856", "user": "a" },
        { "id": "484904", "user": "a" },
        { "id": "484906", "user": "a" },
        { "id": "484957", "user": "a" },
        { "id": "485125", "user": "a" },
        { "id": "485257", "user": "a" },
        { "id": "485320", "user": "a" },
        { "id": "485325", "user": "a" },
        { "id": "485375", "user": "a" },
        { "id": "485656", "user": "a" },
        { "id": "485741", "user": "a" },
        { "id": "485870", "user": "a" },
        { "id": "486002", "user": "a" },
        { "id": "486098", "user": "a" },
        { "id": "486181", "user": "a" },
        { "id": "486278", "user": "a" },
        { "id": "486322", "user": "a" },
        { "id": "486414", "user": "a" },
        { "id": "486819", "user": "a" },
        { "id": "486899", "user": "a" },
        { "id": "486978", "user": "a" },
        { "id": "487058", "user": "a" },
        { "id": "487066", "user": "a" },
        { "id": "487160", "user": "a" },
        { "id": "487178", "user": "a" },
        { "id": "487453", "user": "a" },
        { "id": "487464", "user": "a" },
        { "id": "487575", "user": "a" },
        { "id": "487583", "user": "a" },
        { "id": "487715", "user": "a" },
        { "id": "487846", "user": "a" },
        { "id": "488094", "user": "a" },
        { "id": "488192", "user": "a" },
        { "id": "488193", "user": "a" },
        { "id": "488210", "user": "a" },
        { "id": "494779", "user": "TrueGraphik" },
        { "id": "494858", "user": "nick" },
        { "id": "495021", "user": "magicpatch" },
        { "id": "495064", "user": "Rementera" },
        { "id": "495664", "user": "sacriforce" },
        { "id": "496012", "user": "MR_T" },
        { "id": "496349", "user": "smek2" },
        { "id": "496359", "user": "konspiracy" },
        { "id": "496578", "user": "phlojo" },
        { "id": "496798", "user": "ion" },
        { "id": "496826", "user": "rob_pc" },
        { "id": "496948", "user": "rico_escabar" },
        { "id": "497061", "user": "DigitalMan" },
        { "id": "498208", "user": "wyclef" },
        { "id": "498343", "user": "tonx" },
        { "id": "498694", "user": "ckentish" },
        { "id": "498815", "user": "deke" },
        { "id": "498932", "user": "MrDinky" },
        { "id": "498993", "user": "drunktank" },
        { "id": "499262", "user": "basit" },
        { "id": "500159", "user": "supes" },
        { "id": "500204", "user": "loudubs" },
        { "id": "500231", "user": "asone" },
        { "id": "500658", "user": "Dita" },
        { "id": "501005", "user": "Jerome" },
        { "id": "501881", "user": "cruz_azul" },
        { "id": "502117", "user": "JazX" },
        { "id": "502309", "user": "burger" },
        { "id": "502496", "user": "cirquedesign" },
        { "id": "502633", "user": "derrickito" },
        { "id": "503318", "user": "chunkylover" },
        { "id": "503419", "user": "wadafa" },
        { "id": "503576", "user": "dyoung" },
        { "id": "503656", "user": "popeluke" },
        { "id": "503873", "user": "ikbenvanrijn" },
        { "id": "504320", "user": "F_EddyShears" },
        { "id": "504324", "user": "mitee_" },
        { "id": "504453", "user": "designaked" },
        { "id": "504514", "user": "4cY" },
        { "id": "504582", "user": "gluekit" },
        { "id": "504705", "user": "3rror404" },
        { "id": "504750", "user": "MX_OnD" },
        { "id": "504806", "user": "lilbabyleg" },
        { "id": "504863", "user": "oeuf" },
        { "id": "505018", "user": "sajets" },
        { "id": "505047", "user": "p1xelfrog" },
        { "id": "505114", "user": "Imyj" },
        { "id": "505766", "user": "scratch" },
        { "id": "505814", "user": "scarabin_" },
        { "id": "506053", "user": "JIBHUNT" },
        { "id": "506203", "user": "MindSmack" },
        { "id": "506480", "user": "goldenhands" },
        { "id": "506506", "user": "LEFREAK" },
        { "id": "506636", "user": "irrelevant" },
        { "id": "506671", "user": "EngageSayBye" },
        { "id": "506729", "user": "DrSatan" },
        { "id": "507099", "user": "bebop" },
        { "id": "507140", "user": "fehvenbach" },
        { "id": "507237", "user": "flavorful" },
        { "id": "507372", "user": "giorgi" },
        { "id": "507380", "user": "mikotondria2" },
        { "id": "507598", "user": "dahmc" },
        { "id": "507681", "user": "BXCAR" },
        { "id": "507740", "user": "m_bagnall" },
        { "id": "507823", "user": "blacklist" },
        { "id": "507973", "user": "Vectorpimp" },
        { "id": "508069", "user": "Dita__" },
        { "id": "508144", "user": "drake" },
        { "id": "508264", "user": "DogsBreath" },
        { "id": "508649", "user": "donbrewer" },
        { "id": "508732", "user": "reaper" },
        { "id": "508787", "user": "North_2" },
        { "id": "508917", "user": "DeleteBoy" },
        { "id": "508987", "user": "734" },
        { "id": "509012", "user": "SireDeeK" },
        { "id": "509151", "user": "tri" },
        { "id": "509208", "user": "sputnik" },
        { "id": "509324", "user": "tara|gee" },
        { "id": "509349", "user": "S79" },
        { "id": "509362", "user": "beakman" },
        { "id": "509735", "user": "ohyo" },
        { "id": "509741", "user": "ORAZAL" },
        { "id": "509900", "user": "cuauhtemoc" },
        { "id": "509961", "user": "aurablue" },
        { "id": "509982", "user": "BeachBoy" },
        { "id": "510055", "user": "CptYesterday" },
        { "id": "510192", "user": "pixelbreaker" },
        { "id": "510334", "user": "_jens_" },
        { "id": "510710", "user": "heydontbugme" },
        { "id": "510727", "user": "ithis" },
        { "id": "510728", "user": "krtv" },
        { "id": "510759", "user": "Q-B-N" },
        { "id": "510767", "user": "wph" },
        { "id": "510837", "user": "Bottlerocket" },
        { "id": "510911", "user": "thong" },
        { "id": "510918", "user": "steakandliquor" },
        { "id": "510943", "user": "martynR" },
        { "id": "510945", "user": "bxcr_dave" },
        { "id": "510955", "user": "xavixaf1" },
        { "id": "511011", "user": "bijo2" },
        { "id": "511056", "user": "IamFerris" },
        { "id": "511114", "user": "fluxismo" },
        { "id": "511228", "user": "1977" },
        { "id": "511299", "user": "SUPREMENIGGA" },
        { "id": "511324", "user": "ithisltd" },
        { "id": "511437", "user": "Tyrone2" },
        { "id": "511484", "user": "Kuz" },
        { "id": "511500", "user": "polarunion" },
        { "id": "511501", "user": "JEWUNIT" },
        { "id": "511504", "user": "imp" },
        { "id": "511519", "user": "parasew" },
        { "id": "511581", "user": "dave_boxcar" },
        { "id": "511728", "user": "chrisartist76" },
        { "id": "511796", "user": "lost" },
        { "id": "511808", "user": "davej" },
        { "id": "511855", "user": "Miss_Dita" },
        { "id": "511857", "user": "wolfbag" },
        { "id": "511902", "user": "Mr_Niggles" },
        { "id": "511909", "user": "1978" },
        { "id": "511929", "user": "QBNBlows" },
        { "id": "511942", "user": "puter" },
        { "id": "511983", "user": "dave|bxcr" },
        { "id": "512002", "user": "Tyrone3" },
        { "id": "512076", "user": "BLACKJESUS" },
        { "id": "512087", "user": "Blacksuperjesus" },
        { "id": "512112", "user": "patrickalgrim" },
        { "id": "512122", "user": "tfs|mag" },
        { "id": "512123", "user": "tee_ef_ess" },
        { "id": "512162", "user": "Iam1977" },
        { "id": "512172", "user": "yunngg1" },
        { "id": "512177", "user": "FutchOven" },
        { "id": "512188", "user": "metrosexual" },
        { "id": "512201", "user": "_-_-_" },
        { "id": "512211", "user": "ramon_c_m" },
        { "id": "512217", "user": "GuyWithKnife" },
        { "id": "512220", "user": "dog80" },
        { "id": "512221", "user": "alun" },
        { "id": "512239", "user": "1977_c" },
        { "id": "512370", "user": "KarlMorrow" },
        { "id": "512390", "user": "ideal" },
        { "id": "512411", "user": "JEWUNIT_" },
        { "id": "512424", "user": "son" },
        { "id": "512470", "user": "JEWUNITNIGGA" },
        { "id": "512471", "user": "NTMOSTUNWANTED" },
        { "id": "512492", "user": "tehlol" },
        { "id": "512625", "user": "North_3" },
        { "id": "512630", "user": "citizenfish" },
        { "id": "512635", "user": "lawnturn" },
        { "id": "512657", "user": "SEXY_BEAST" },
        { "id": "512660", "user": "jmf" },
        { "id": "512662", "user": "todelete__2" },
        { "id": "512815", "user": "r1977" },
        { "id": "512869", "user": "19_77" },
        { "id": "512941", "user": "GooG" },
        { "id": "512947", "user": "wolf_bag" },
        { "id": "512961", "user": "QBN2" },
        { "id": "512962", "user": "wolf-bag" },
        { "id": "512963", "user": "Wolfbaggy" },
        { "id": "512964", "user": "NickTrauma" },
        { "id": "512969", "user": "Ordell" },
        { "id": "512990", "user": "NiGrrr" },
        { "id": "513050", "user": "skt" },
        { "id": "513062", "user": "Plura" },
        { "id": "513072", "user": "AuthorizedDeal" },
        { "id": "513188", "user": "fishsticks" },
        { "id": "513208", "user": "b00tie" },
        { "id": "513233", "user": "designerror" },
        { "id": "513283", "user": "2cY" },
        { "id": "513314", "user": "jj-giddy" },
        { "id": "513351", "user": "holycow" },
        { "id": "513401", "user": "dany701" },
        { "id": "513415", "user": "tough_actin" },
        { "id": "513421", "user": "lake_palmer" },
        { "id": "513518", "user": "drrose" },
        { "id": "513542", "user": "tomc" },
        { "id": "513568", "user": "drunkmonkey" },
        { "id": "513571", "user": "letters" },
        { "id": "513619", "user": "submergedMIND" },
        { "id": "513654", "user": "jjbob" },
        { "id": "513674", "user": "igolai" },
        { "id": "513728", "user": "surgical_steel" },
        { "id": "513734", "user": "SuperSport" },
        { "id": "513736", "user": "max_prophet" },
        { "id": "513789", "user": "reg" },
        { "id": "513802", "user": "yourmom" },
        { "id": "513821", "user": "BadTimingGuy" },
        { "id": "513869", "user": "syed" },
        { "id": "513892", "user": "digdre" },
        { "id": "514014", "user": "sarahb" },
        { "id": "514015", "user": "derek3" },
        { "id": "514016", "user": "09051989" },
        { "id": "514017", "user": "seangetti2" },
        { "id": "514212", "user": "eerieechidna" },
        { "id": "514223", "user": "JSark" },
        { "id": "514421", "user": "eric_jordan" },
        { "id": "514424", "user": "todd_purgason" },
        { "id": "514425", "user": "Richelieu" },
        { "id": "514438", "user": "Beach_Boy" },
        { "id": "514482", "user": "Help" }]


const missingProfiles = [
        { "id": "514529", "user": "GMAIL" },
        { "id": "514532", "user": "Politics" },
        { "id": "514576", "user": "sean_TNMC" },
        { "id": "514581", "user": "mogollon" },
        { "id": "514692", "user": "gsw" },
        { "id": "514694", "user": "mr_buddy" },
        { "id": "514906", "user": "5uper" },
        { "id": "514908", "user": "drop_shadow" },
        { "id": "514914", "user": "HATEORADE" },
        { "id": "514949", "user": "feltdesign" },
        { "id": "514981", "user": "countvoncount" },
        { "id": "514998", "user": "george_bush" },
        { "id": "515040", "user": "bugayo" },
        { "id": "515120", "user": "aquarius_moon7" },
        { "id": "515180", "user": "3rr0r404" },
        { "id": "515189", "user": "kirkgibson" },
        { "id": "515282", "user": "Neo_con_fuckwit" },
        { "id": "515343", "user": "drk" },
        { "id": "515344", "user": "johnnyhashcraft" },
        { "id": "515376", "user": "IHateDutchBoy" },
        { "id": "515388", "user": "CD-RW" },
        { "id": "515396", "user": "Sean_Morgan" },
        { "id": "515453", "user": "bitsurfer" },
        { "id": "515472", "user": "Sean_Getti" },
        { "id": "515484", "user": "steaknliquor" },
        { "id": "515485", "user": "supermedium" },
        { "id": "515486", "user": "porkrindsnlime" },
        { "id": "515487", "user": "not_shant" },
        { "id": "515547", "user": "rick_james" },
        { "id": "515552", "user": "po|arunion" },
        { "id": "515593", "user": "aadaam" },
        { "id": "515598", "user": "JohnnyDropKick" },
        { "id": "515599", "user": "ChrisDick" },
        { "id": "515600", "user": "sixtailerdick" },
        { "id": "515712", "user": "wunderbra" },
        { "id": "515777", "user": "fusedliving" },
        { "id": "515827", "user": "Fisticuff" },
        { "id": "515863", "user": "dickPounds" },
        { "id": "515884", "user": "i_hate_dutchboy" },
        { "id": "515895", "user": "JUSTICE4ALL" },
        { "id": "515913", "user": "newseater" },
        { "id": "515929", "user": "friends4ever" },
        { "id": "515938", "user": "robotfacekilla" },
        { "id": "515944", "user": "jebarabia" },
        { "id": "516010", "user": "mtby" },
        { "id": "516092", "user": "ssssssssssseth" },
        { "id": "516112", "user": "CitizenRockstar" },
        { "id": "516117", "user": "PeterPecker" },
        { "id": "516131", "user": "henrycrinkle" },
        { "id": "516192", "user": "darkprogram" },
        { "id": "516366", "user": "p0wdah" },
        { "id": "516372", "user": "w_rk" },
        { "id": "516383", "user": "Witt" },
        { "id": "516418", "user": "pimpDog42" },
        { "id": "516437", "user": "TomJudd" },
        { "id": "516454", "user": "marsharab73" },
        { "id": "516551", "user": "ybby" },
        { "id": "516573", "user": "remembermekilla" },
        { "id": "516598", "user": "dr_strangedub" },
        { "id": "516684", "user": "TheTick" },
        { "id": "516725", "user": "hotreport" },
        { "id": "516770", "user": "branimal" },
        { "id": "516906", "user": "fawn" },
        { "id": "517159", "user": "4est" },
        { "id": "517190", "user": "electricmaoII" },
        { "id": "517191", "user": "Galaxian" },
        { "id": "517350", "user": "bots" },
        { "id": "517358", "user": "CrackHouse_Chic" },
        { "id": "517373", "user": "ckn" },
        { "id": "517429", "user": "American-Gigolo" },
        { "id": "517440", "user": "mevthem" },
        { "id": "517540", "user": "Krakow_Chic" },
        { "id": "517662", "user": "cock" },
        { "id": "517712", "user": "Rapheal" },
        { "id": "517758", "user": "lele" },
        { "id": "517766", "user": "cirquemedia" },
        { "id": "517848", "user": "k0na_anOk" },
        { "id": "517856", "user": "pushbutton" },
        { "id": "517942", "user": "hiroshima" },
        { "id": "517949", "user": "Jevard" },
        { "id": "517980", "user": "JohnnyMoe" },
        { "id": "517981", "user": "MissyWeblash" },
        { "id": "518047", "user": "visualeipstm" },
        { "id": "518070", "user": "randoman" },
        { "id": "518080", "user": "mrs_snuggles" },
        { "id": "518091", "user": "uberdesigner" },
        { "id": "518128", "user": "Dereks_Dad" },
        { "id": "518142", "user": "Kes" },
        { "id": "518168", "user": "determinedmoth" },
        { "id": "518303", "user": "_harold" },
        { "id": "518561", "user": "ShawnP" },
        { "id": "518570", "user": "streamhub" },
        { "id": "518697", "user": "sara|gee" },
        { "id": "518740", "user": "cara|gee" },
        { "id": "518818", "user": "AttacK2" },
        { "id": "518851", "user": "Whoopi" },
        { "id": "518975", "user": "blowback33" },
        { "id": "518977", "user": "jteore" },
        { "id": "519163", "user": "curedjinx" },
        { "id": "519305", "user": "Vendetta" },
        { "id": "519434", "user": "meversusthem" },
        { "id": "519628", "user": "explosive" },
        { "id": "519712", "user": "mrwinky" },
        { "id": "519760", "user": "Zachass_inc" },
        { "id": "519790", "user": "fortified" },
        { "id": "519803", "user": "hotreport2" },
        { "id": "519804", "user": "hotreport3" },
        { "id": "519820", "user": "Gusto" },
        { "id": "519835", "user": "QBIEN" },
        { "id": "519875", "user": "backwards" },
        { "id": "519876", "user": "NeoStar" },
        { "id": "519989", "user": "kcin" },
        { "id": "519992", "user": "elCajon" },
        { "id": "520103", "user": "JesseJensen" },
        { "id": "520137", "user": "randoman2" },
        { "id": "520146", "user": "ramdoman" },
        { "id": "520326", "user": "ohyeahbaby" },
        { "id": "520484", "user": "Crouwel" },
        { "id": "520497", "user": "pat_gryb" },
        { "id": "520576", "user": "mozak" },
        { "id": "520579", "user": "KILLputer" },
        { "id": "520627", "user": "garett" },
        { "id": "520628", "user": "garettwest" },
        { "id": "520718", "user": "usversusthem" },
        { "id": "520734", "user": "jag" },
        { "id": "520741", "user": "my_8th_account" },
        { "id": "520876", "user": "alt3rego" },
        { "id": "520930", "user": "hanspecans" },
        { "id": "521008", "user": "neferiu" },
        { "id": "521010", "user": "lounger" },
        { "id": "521155", "user": "wristtattoo" },
        { "id": "521189", "user": "RoyBoy" },
        { "id": "521200", "user": "bot" },
        { "id": "521286", "user": "9832892398" },
        { "id": "521289", "user": "KEVINROSELOVER" },
        { "id": "521290", "user": "superfolkert" },
        { "id": "521302", "user": "erter" },
        { "id": "521304", "user": "dsf094309" },
        { "id": "521399", "user": "wootang71" },
        { "id": "521420", "user": "altarnet" },
        { "id": "521714", "user": "cornman" },
        { "id": "521783", "user": "xenicon" },
        { "id": "521847", "user": "trent_reznor" },
        { "id": "521951", "user": "invisiblewyrm" },
        { "id": "521986", "user": "Grzesiek" },
        { "id": "522107", "user": "same" },
        { "id": "522363", "user": "JamiG" },
        { "id": "522386", "user": "darn" },
        { "id": "522591", "user": "twat3" },
        { "id": "522745", "user": "garettsouf" },
        { "id": "522801", "user": "EvanLane" },
        { "id": "522874", "user": "is_a_cock" },
        { "id": "522900", "user": "flipflop" },
        { "id": "523002", "user": "superHen" },
        { "id": "523060", "user": "MrPierre" },
        { "id": "523062", "user": "EricBloom" }
    ]

scrapeProfiles()
